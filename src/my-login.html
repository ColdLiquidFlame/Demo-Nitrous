<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<dom-module id="my-login">
    <template>
        <firebase-app
            api-key="AIzaSyBOR71nQRqGbAIIX9h7aB783T1CVteifS0"
            auth-domain="nitrous-demo.firebaseapp.com"
            database-url="https://nitrous-demo.firebaseio.com">
        </firebase-app>
        <firebase-auth 
            id="auth" 
            user="{{ user }}"
            signed-in="{{ signedIn }}"  
            provider="google"
            on-error="handleError"
            scope="profile">
        </firebase-auth>
        <firebase-document
            path="/users/google:{{ user.providerInfo[0].uid }}"
            data="{{ userInfo }}">
        </firebase-document>

        <div id="login" on-click="login" hidden$="{{ signedIn }}">
            Sign In
        </div>
        <div id="logout" on-click="logout" hidden$="{{ !signedIn }}">
            Hello, {{ _displayName(user) }}
            Sign Out
        </div>
    </template>
    <script>
        class MyLogin extends Polymer.Element {
            static get is() {
                return "my-login";
            }

            static get properties() {
                return {
                    user: Object
                };
            }

            login() {
                this.$.auth.signInWithPopup()
                    .then(function(response) {
                        console.log(response);
                        debugger;
                    }) // optionally handle a successful login})
                    .catch(function(error) {
                        console.log(response);
                        debugger;
                    }); // unsuccessful authentication response here});
            }

            logout() {
                this.$.auth.signOut()
                    .then(function(response) {
                        console.log(response);
                        debugger;
                    }) // optionally handle a successful login})
                    .catch(function(error) {
                        console.log(response);
                        debugger;
                    }); // unsuccessful authentication response here});
            }

            handleError() {
                debugger;
            }

            _displayName(user) {
                if (user === null) return "";

                return user.providerData[0].displayName;
            }
        }

        window.customElements.define(MyLogin.is, MyLogin);
    </script>
</dom-module>